<div class="image-gallery">
  {% assign all_files = site.static_files | where_exp: "file", "file.path contains include.folder" %}
  {% assign gallery_images = "" | split: "" %}
  {% for file in all_files %}
    {% assign ext = file.extname | downcase %}
    {% if ext == '.jpg' or ext == '.jpeg' or ext == '.png' %}
      {% assign gallery_images = gallery_images | push: file %}
    {% endif %}
  {% endfor %}
  {% for image in gallery_images %}
    <img src="{{ image.path | relative_url }}" alt="Gallery image" style="max-width: 300px; margin: 10px;" onclick="openLightbox('{{ image.path | relative_url }}', {{ forloop.index0 }})" data-index="{{ forloop.index0 }}" />
  {% endfor %}
</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox">
  <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
  <button class="lightbox-nav prev" onclick="prevImage()">&lsaquo;</button>
  <button class="lightbox-nav next" onclick="nextImage()">&rsaquo;</button>
  <img class="lightbox-content" id="lightbox-img" />
</div>

<script>
let currentImageIndex = 0;
let galleryImages = [];

function initializeGallery() {
  // Collect all gallery images
  const imgs = document.querySelectorAll('.image-gallery img');
  galleryImages = Array.from(imgs).map(img => ({
    src: img.src,
    index: parseInt(img.dataset.index)
  }));
}

function openLightbox(src, index) {
  const lightbox = document.getElementById('lightbox');
  const img = document.getElementById('lightbox-img');
  
  currentImageIndex = index;
  
  // Show lightbox and set image
  lightbox.style.display = 'block';
  img.src = src;
  
  // Update navigation buttons
  updateNavButtons();
  
  // Trigger animation after a small delay
  setTimeout(() => {
    lightbox.classList.add('show');
  }, 10);
}

function closeLightbox() {
  const lightbox = document.getElementById('lightbox');
  
  // Remove show class for exit animation
  lightbox.classList.remove('show');
  
  // Hide lightbox after animation completes
  setTimeout(() => {
    lightbox.style.display = 'none';
  }, 300);
}

function prevImage() {
  if (currentImageIndex > 0) {
    currentImageIndex--;
    changeImage();
  }
}

function nextImage() {
  if (currentImageIndex < galleryImages.length - 1) {
    currentImageIndex++;
    changeImage();
  }
}

function changeImage() {
  const img = document.getElementById('lightbox-img');
  
  // Simple image change
  img.src = galleryImages[currentImageIndex].src;
  updateNavButtons();
}

function updateNavButtons() {
  const prevBtn = document.querySelector('.lightbox-nav.prev');
  const nextBtn = document.querySelector('.lightbox-nav.next');
  
  prevBtn.disabled = currentImageIndex === 0;
  nextBtn.disabled = currentImageIndex === galleryImages.length - 1;
}

// Initialize gallery when DOM is loaded
document.addEventListener('DOMContentLoaded', initializeGallery);

// Keyboard navigation
document.addEventListener('keydown', function(event) {
  if (document.getElementById('lightbox').style.display === 'block') {
    switch(event.key) {
      case 'Escape':
        closeLightbox();
        break;
      case 'ArrowLeft':
        prevImage();
        break;
      case 'ArrowRight':
        nextImage();
        break;
    }
  }
});

// Prevent lightbox from closing when clicking the image itself
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('lightbox').addEventListener('click', function(e) {
    if (e.target === this) {
      closeLightbox();
    }
  });
});
</script>