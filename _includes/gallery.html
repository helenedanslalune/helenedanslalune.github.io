<div class="image-gallery">
  {% assign all_files = site.static_files | where_exp: "file", "file.path contains include.folder" %}
  {% assign gallery_images = "" | split: "" %}
  {% for file in all_files %}
    {% assign ext = file.extname | downcase %}
    {% if ext == '.jpg' or ext == '.jpeg' or ext == '.png' %}
      {% assign gallery_images = gallery_images | push: file %}
    {% endif %}
  {% endfor %}
  {% for image in gallery_images %}
    <img src="{{ image.path | relative_url }}" alt="{{ image.name | default: 'Gallery image' }}" style="max-width: 300px; margin: 10px; cursor: pointer;" data-index="{{ forloop.index0 }}" tabindex="0" />
  {% endfor %}
</div>

<div id="lightbox" class="lightbox">
  <button id="lightbox-close" class="lightbox-close" aria-label="Close">&times;</button>
  <button id="lightbox-prev" class="lightbox-nav prev" aria-label="Previous">&lsaquo;</button>
  <button id="lightbox-next" class="lightbox-nav next" aria-label="Next">&rsaquo;</button>
  <img id="lightbox-img" class="lightbox-content" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E" alt="" />
</div>

<script>
(function() {
  let index = 0;
  let images = [];
  const lightbox = document.getElementById('lightbox');
  const img = document.getElementById('lightbox-img');

  // Initialize
  document.querySelectorAll('.image-gallery img').forEach((el, i) => {
    images.push(el.src);
    el.onclick = () => open(i);
    el.onkeydown = e => (e.key === 'Enter' || e.key === ' ') && open(i);
  });

  document.getElementById('lightbox-close').onclick = close;
  document.getElementById('lightbox-prev').onclick = () => nav(-1);
  document.getElementById('lightbox-next').onclick = () => nav(1);
  lightbox.onclick = e => e.target === lightbox && close();

  document.onkeydown = e => {
    if (lightbox.style.display !== 'block') return;
    if (e.key === 'Escape') close();
    if (e.key === 'ArrowLeft') nav(-1);
    if (e.key === 'ArrowRight') nav(1);
  };

  function open(i) {
    index = i;
    img.src = images[i];
    lightbox.style.display = 'block';
    setTimeout(() => lightbox.classList.add('show'), 10);
    updateNav();
  }

  function close() {
    lightbox.classList.remove('show');
    setTimeout(() => lightbox.style.display = 'none', 300);
  }

  function nav(dir) {
    const newIndex = index + dir;
    if (newIndex >= 0 && newIndex < images.length) {
      index = newIndex;
      img.src = images[index];
      updateNav();
    }
  }

  function updateNav() {
    document.getElementById('lightbox-prev').disabled = index === 0;
    document.getElementById('lightbox-next').disabled = index === images.length - 1;
  }
})();
</script>